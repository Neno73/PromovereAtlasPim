# PromoAtlas PIM System

*Generated by thoughtful-dev - Last updated: 2025-10-29 19:40*

## Quick Context

PromoAtlas is a Strapi 5-based Product Information Management (PIM) system for managing promotional products from Promidata suppliers. The system features automated product synchronization with hash-based incremental updates, multilingual support (NL/DE/EN/FR), and Cloudflare R2 image storage. Backend runs on Strapi 5.17.0 with PostgreSQL (Neon), frontend uses React 18 + TypeScript with Vite.

## Essential Commands

### Backend (Strapi 5)
```bash
cd backend
npm run develop      # Start development server with auto-reload
npm run build       # Build for production
npm run start       # Start production server
npm run console     # Open Strapi console
npm run deploy      # Deploy to configured environment
```

### Frontend (React + Vite)
```bash
cd frontend
npm run dev         # Start Vite development server (port 3001)
npm run build       # Build for production (TypeScript + Vite)
npm run lint        # Run ESLint with TypeScript rules
npm run preview     # Preview production build
```

### Service URLs
- **Backend Admin**: http://localhost:1337/admin
- **Backend API**: http://localhost:1337/api
- **Frontend Dev**: http://localhost:3001

## Core Principles

### MANDATORY Rules

**Git Workflow (ABSOLUTE)**:
- ALWAYS work on feature/fix/refactor branches
- NEVER push directly to main/master
- ALWAYS create PR after work completion
- Branch naming: `feature/description`, `fix/description`, `refactor/description`

**Database Operations**:
- ALWAYS use transactions for multi-step database changes
- STOP and ask before ANY destructive operations (DROP, DELETE, TRUNCATE)
- Show exact query/migration before running destructive operations
- Leverage Neon MCP for database operations (`mcp__neon__*` tools)

**Environment & Secrets**:
- NEVER commit .env files
- ALWAYS check for hardcoded secrets before commits
- Create .env.example with dummy values

**Directory Context**:
- Backend work: `cd backend/` first
- Frontend work: `cd frontend/` first
- Use `npm run develop` (NOT `dev`) for Strapi backend

### DO NOT

- Skip requirements clarification for new features (use `requirements-clarifier` skill)
- Skip implementation planning for non-trivial work (use `implementation-planner` skill)
- Work directly on main/master branch
- Commit without verifying no secrets are included
- Use `npm run dev` for backend (Strapi uses `develop`)

### Architecture Principles (Black Box Design)

Based on Eskil Steenberg's principles:
1. **Constant Velocity** - Write 5 lines today vs. edit 1 line later
2. **Complete Ownership** - One module, one person (complete understanding)
3. **Everything Replaceable** - If you can't understand it, rewrite it
4. **Black Box Interfaces** - Clean APIs hide implementation details
5. **Single Responsibility** - One module, one purpose

## Documentation Maintenance

Mode: **ask**

The `doc-maintenance` skill will remind you to update documentation after:
- Adding/removing dependencies
- Changing architecture or patterns
- Refactoring code structure

Set to `auto` for automatic updates, or `ask` to be prompted (recommended).

Run `/thoughtful-dev:audit-docs` periodically to check for drift.

## Imported Documentation

When working on specific areas, these detailed docs are auto-loaded:

- **@.claude/STACK.md** - Tech stack with versions and rationale (Strapi 5, React 18, Vite, PostgreSQL, R2)
- **@.claude/ARCHITECTURE.md** - System design and component structure (content types, services, frontend components)
- **@.claude/PATTERNS.md** - Code conventions used in THIS project (TypeScript patterns, service layer, CSS modules)
- **@.claude/STARTUP.md** - Setup guide and troubleshooting (environment variables, database setup, service URLs)
- **@.claude/GOTCHAS.md** - Known issues and workarounds (image fitting, multilingual text, pagination)
- **@.claude/DECISIONS.md** - Architectural decision history (logged as changes are made)

## Key System Features

### Promidata Sync Service
- **Hash-based incremental sync**: Only processes products with changed SHA-1 hashes (89% efficiency achieved)
- **Multilingual support**: Handles NL/DE/EN/FR product data as JSON fields
- **Cloudflare R2 storage**: Automated image uploads with public access
- **Category import**: Processes CAT.csv for product categorization
- **56 suppliers**: Promidata suppliers A23-A618 with enable/disable control

### Content Types (Updated 2025-10-29)
- **Product**: Main product/family with SKU, a_number, multilingual name/description, 8-tier pricing, dimensions, images. Has many variants.
- **Product Variant**: Size/color variations of products (SKU, dimensions, color, size, hex_color, is_primary_for_color). Belongs to Product.
- **Supplier**: 56 Promidata suppliers with sync status tracking
- **Category**: Hierarchical categorization with multilingual names
- **Sync Configuration**: Tracks sync operations and performance metrics
- **AutoRAG Integration**: Real-time product sync to vector database

**Architecture**: Product → Product Variant (two-level hierarchy for better variant management)

### Frontend Features
- **Smart image fitting**: Adaptive cover/contain strategy based on aspect ratio
- **Advanced filtering**: Search, category, supplier, price range, brand, active status
- **Pagination**: 12 products per page with sorting options
- **Multilingual display**: Language fallback chain (en → de → fr → es)
- **Responsive design**: CSS Modules with mobile-first approach

## MCP Tools Available

### Neon Database MCP
- Use for all database operations (queries, migrations, schema changes)
- Commands: `mcp__neon__run_sql`, `mcp__neon__describe_table_schema`, `mcp__neon__get_database_tables`

### Strapi MCP
- Direct Strapi API interactions for content management
- Advanced content operations and debugging

### Playwright MCP
- Browser automation and frontend testing
- Visual documentation with screenshots
- UI validation and interaction testing

### Datadog MCP
- Performance monitoring and metrics
- Log analytics and aggregation
- Alert management for system health

### Sentry MCP
- Error tracking and monitoring
- Stack trace analysis
- Performance monitoring

## Problem-Solving Approach

### For Routine Work
- Apply best practices from @.claude/PATTERNS.md
- Solve efficiently using documented patterns
- Don't overthink standard implementations

### When Genuinely Stuck
- Invoke `breakthrough-generator` skill for systematic problem-solving
- Apply appropriate technique based on problem type
- Be honest about what you've ACTUALLY tried vs. what you THINK you've tried

### Before Implementing New Features
1. **Invoke `requirements-clarifier` skill** - Ensure genuine understanding
2. **Invoke `implementation-planner` skill** - Plan before coding (for non-trivial work)
3. Get explicit agreement before starting implementation

## Session Hygiene

- Use `/clear` between unrelated tasks to prevent context pollution
- Fresh start = fresh perspective
- Don't let context from previous problems bleed into current work

---

*This documentation serves both humans AND Claude Code. Update as the system evolves.*
